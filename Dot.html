<html>

<head>

<style>
	body {
		margin: 0;
	}

	a {
		background: transparent url('Default.png') no-repeat scroll top right;
		font: 50px "Lucida Grande";
		font-weight: bold;
		color: white;
		text-align: center;
		display: block;
		float: left;
		text-decoration: none;
		width: 210px;
		height: 115px;
	}

	span {
		display: block;
		padding: 25px 0 0px 0px;
	}
</style>

<script type="text/javascript">
	function getNextPeriod( lastPeriod ) {
		var daysPerCycle = 28;
		var hoursPerCycle = daysPerCycle * 24;
		var minutesPerCycle = hoursPerCycle * 60;
		var secondsPerCycle = minutesPerCycle * 60;
		var millisPerCycle = secondsPerCycle * 1000;
		return lastPeriod + millisPerCycle;
	}

	function getDaysTill( time ) {
		var now = zeroDate(new Date()).getTime();
		var nanosTill = time - now;
		var secondsTill = nanosTill / 1000;
		var minutesTill = secondsTill / 60;
		var hoursTill = minutesTill / 60;
		var daysTill = hoursTill / 24;
		return daysTill;
	}

	function zeroDate( d ) {
		d.setHours(0);
		d.setMinutes(0);
		d.setSeconds(0);
		d.setMilliseconds(0);
		return d;
	}

	function fixMeUpScotty() {
		localStorage["lastPeriod"] = zeroDate(new Date()).getTime();
		engageMrSulu();
	}

	function wheresMyShipScotty() {
		var tomorrow = new Date();
		tomorrow.setDate(tomorrow.getDate() + 1);
		setTimeout("engageMrSulu();", zeroDate(tomorrow).getTime() - zeroDate(new Date()).getTime());
	}

	function engageMrSulu() {
		var lastPeriod = localStorage["lastPeriod"];
		document.getElementById("days").innerText = lastPeriod == null ? "." : getDaysTill(getNextPeriod(parseInt(lastPeriod)));
	}
</script>

</head>

<body>
		<a href="#" onclick="fixMeUpScotty();">
		<span id="days">Loading...</span>
		</a>

		<script type="text/javascript">
			engageMrSulu();
			wheresMyShipScotty();
		</script>
</body>

</html>
